<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [X-Unix] How to determine which network component is failing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:x-unix%40listserver.themacintoshguy.com?Subject=%5BX-Unix%5D%20How%20to%20determine%20which%20network%20component%20is%20failing&In-Reply-To=7097bd8c0607241027l6488580bjd4f8d83e2b892d28%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002709.html">
   <LINK REL="Next"  HREF="002716.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">

<!--GoogleAdsAutomaticSizeSTART-->
<p align=CENTER>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Automatic Size -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1785703837751368"
     data-ad-slot="4468313549"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</p>
<!--GoogleAdsAutomaticSizeEND-->

   <H1>[X-Unix] How to determine which network component is failing</H1>
    <B>Charles Howse</B> 
    <A HREF="mailto:x-unix%40listserver.themacintoshguy.com?Subject=%5BX-Unix%5D%20How%20to%20determine%20which%20network%20component%20is%20failing&In-Reply-To=7097bd8c0607241027l6488580bjd4f8d83e2b892d28%40mail.gmail.com"
       TITLE="[X-Unix] How to determine which network component is failing">chowse at charter.net
       </A><BR>
    <I>Tue Jul 25 16:33:25 PDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002709.html">[X-Unix] How to determine which network component is failing
</A></li>
        <LI>Next message: <A HREF="002716.html">[X-Unix] How to determine which network component is failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2714">[ date ]</a>
              <a href="thread.html#2714">[ thread ]</a>
              <a href="subject.html#2714">[ subject ]</a>
              <a href="author.html#2714">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jul 24, 2006, at 12:27 PM, Wing Wong wrote:

&gt;<i> On 7/23/06, Charles Howse &lt;<A HREF="../../../mailman/listinfo/x-unix.html">chowse at charter.net</A>&gt; wrote:
</I>&gt;&gt;<i> Hardware setup:
</I>&gt;&gt;<i> ISP: Charter Communications, 2 megabit service
</I>&gt;&gt;<i> Cable Modem: Motorola SB4200 Surfboard
</I>&gt;&gt;<i> Router: Linksys Etherfast(r) Cable/DSL Router BEFSR41 V3 Firmware
</I>&gt;&gt;<i> Version: 1.04.17
</I>&gt;&gt;<i> Computers: 2 FreeBSD 6.1-RELEASE. 1 Mac OS X 10.4.7, 100 baseT
</I>&gt;&gt;<i> ethernet connections on all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This morning, I was offline, and just by accident decided to try and
</I>&gt;&gt;<i> release and renew the ip address using the web interface of the  
</I>&gt;&gt;<i> router.
</I>&gt;&gt;<i> BINGO!  Online again!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is this an indication that the router is not noticing that the lease
</I>&gt;&gt;<i> has expired on my dhcp assigned ip address from the modem?  Or is it
</I>&gt;&gt;<i> an indication that the modem is not renewing it's ip address?  Or is
</I>&gt;&gt;<i> it something else?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can I tell the router to release / renew the ip address from a shell
</I>&gt;&gt;<i> script?
</I>&gt;<i>
</I>&gt;<i> Yes. I have a WRT54G Linksys router hooked up to my cablemodem and
</I>&gt;<i> this does indeed happen once in a while. Basically, when this happens,
</I>&gt;<i> one of two things happen:
</I>&gt;<i>
</I>&gt;<i> 1) the cablemodem/service has died and the cablemodem needs to be  
</I>&gt;<i> power-cycled.
</I>&gt;<i> 2) the dhcp lease needs to be renewed.
</I>&gt;<i>
</I>&gt;<i> Typically, I've found the lease to work fine by itself. But from time
</I>&gt;<i> to time, it doesn't. :/ The reasons for this vary, but I'm guessing
</I>&gt;<i> it's someone bouncing something over at the cable provider side and
</I>&gt;<i> the lease is just &quot;forgotten&quot;, leaving your router with a useless
</I>&gt;<i> lease. So, hitting the release/renew will let you grab a new useful
</I>&gt;<i> lease, and back on the net.
</I>&gt;<i>
</I>&gt;<i> I suppose you could script a lynx application to login to the web
</I>&gt;<i> interface of your Linksys router and perform a lease release/renew
</I>&gt;<i> once in while or when it is unable to access some remote server on the
</I>&gt;<i> internet.
</I>&gt;<i>
</I>&gt;<i> Ie,
</I>&gt;<i>
</I>&gt;<i> 1) am I able to see the world?
</I>&gt;<i> ** check google.com
</I>&gt;<i> ** check msn.com
</I>&gt;<i> ** check yourfavoritesite.com
</I>&gt;<i> If at least one is up, then you are essentially live and the other two
</I>&gt;<i> sites are coincidentally dead.
</I>&gt;<i>
</I>&gt;<i> 2) If I'm not up, let's run the scripted lynx session to perform a
</I>&gt;<i> release/renew of my IP address on the router.
</I>&gt;<i>
</I>&gt;<i> 3) Check output of the script. Did I actually get an IP address or am
</I>&gt;<i> I still stuck with 0.0.0.0? Wait a bit longer and run the scripted
</I>&gt;<i> lynx to read the DHCP address from the router again. If fail yet
</I>&gt;<i> again, scream for help!!
</I>&gt;<i>
</I>&gt;<i> If you have some means to, you could script a powercycle of the cable
</I>&gt;<i> modem itself with an intelligent power socket. (serial control or over
</I>&gt;<i> net control) Just make sure you don't powercycle more frequently than
</I>&gt;<i> necessary. I've blown devices that way. ;) If you powercycle every
</I>&gt;<i> 30seconds to every 5 minutes, it's amazing what 2 solid weeks of power
</I>&gt;<i> cycling will do to a device.
</I>&gt;<i>
</I>Here's what I have so far (not working to suit me), but we haven't  
thought out all the scenarios yet.  Not ready to release/renew the  
dhcp lease nor reboot the modem yet.

Example: I ran what I have so far with the modem in standby, and  
terminal returned:
[<A HREF="../../../mailman/listinfo/x-unix.html">charles at larry</A>:~]$ bin/online.sh
ping: cannot resolve google.com: Unknown host
That makes sense, but the $logfile now contains:
Tue Jul 25 18:19:30 CDT 2006
host1 online, exiting
That's because the script didn't return any ping results, just the  
failure to resolve the name.
I need help with:
1) what if my 3 pings returns only 1, or 2?  That equals online, but  
it's easier to test against $offline (below).  Therefore, the script  
will think the host is offline unless it returns all 3 pings.




#!/bin/bash

logfile=Documents/online.txt
stats=`curl -s <A HREF="http://192.168.100.1/signaldata.html">http://192.168.100.1/signaldata.html</A> | grep dB | tr -d  
\&lt;TD\&gt; | tr -d /`
offline='3 packets transmitted, 0 packets received, 100% packet loss'

what_failed () {
	echo &gt;&gt; $logfile
	echo OFFLINE &gt;&gt; $logfile
       	date &gt;&gt; $logfile
	ping -c 3 localhost | tail -3 &gt;&gt; $logfile
	echo &gt;&gt; $logfile
	ping -c 3 larry | tail -3 &gt;&gt; $logfile
	echo &gt;&gt; $logfile
	ping -c 3 moe | tail -3 &gt;&gt; $logfile
	echo &gt;&gt; $logfile
	ping -c 3 router | tail -3 &gt;&gt; $logfile
	echo &gt;&gt; $logfile
	ping -c 3 modem | tail -3 &gt;&gt; $logfile
	echo &gt;&gt; $logfile
	echo &quot;$stats&quot; &gt;&gt; $logfile
}

if [ ! &quot;`ping -c 3 google.com | grep packets`&quot; == &quot;$offline&quot; ] ; then
	date &gt;&gt; $logfile
	echo host1 online, exiting &gt;&gt; $logfile
	exit 0
elif
	[ ! &quot;`ping -c 3 microsoft.com | grep packets`&quot; == &quot;$offline&quot; ] ; then
	date &gt;&gt; $logfile
	echo host2 online, exiting &gt;&gt; $logfile
	exit 0
elif
	[ ! &quot;`ping -c 3 yahoo.com | grep packets`&quot; == &quot;$offline&quot; ] ; then
	date &gt;&gt; $logfile
	echo host3 online, exiting &gt;&gt; $logfile
	exit 0
else
	what_failed
fi

exit 0

--
Thanks,
Charles
<A HREF="http://bubbabbq.homeunix.net">http://bubbabbq.homeunix.net</A>


</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002709.html">[X-Unix] How to determine which network component is failing
</A></li>
	<LI>Next message: <A HREF="002716.html">[X-Unix] How to determine which network component is failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2714">[ date ]</a>
              <a href="thread.html#2714">[ thread ]</a>
              <a href="subject.html#2714">[ subject ]</a>
              <a href="author.html#2714">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/x-unix.html">More information about the X-Unix
mailing list</a><br>
<hr />
<!--GoogleAdsAutomaticSizeSTART-->
<p align=CENTER>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Automatic Size -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1785703837751368"
     data-ad-slot="4468313549"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</p>
<!--GoogleAdsAutomaticSizeEND-->

</body></html>
